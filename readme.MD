# GISHUR Monorepo

A **pnpm + Turborepo** microservices monorepo for the BridgePoint system.
Services share **TypeScript config**, a **central env loader**, and **shared types**.

---

## ğŸ“‚ Project Structure

``` bash
GISHUR/
â”œâ”€ packages/
â”‚  â”œâ”€ env/        # Shared env loader (@bridgepoint/env)
â”‚  â”œâ”€ tsconfig/   # Shared TS configs (@bridgepoint/tsconfig)
â”‚  â””â”€ types/      # Shared TypeScript types (@bridgepoint/types)
â”‚
â”œâ”€ services/
â”‚  â”œâ”€ auth-service     # Auth & JWT
â”‚  â”œâ”€ db-service       # Mongo/Mongoose access
â”‚  â”œâ”€ engine           # Core workflow engine
â”‚  â”œâ”€ gateway-api      # HTTP API gateway
â”‚  â””â”€ mail-service     # Email sender
â”‚
â”œâ”€ docker-compose.yml
â”œâ”€ pnpm-workspace.yaml
â”œâ”€ turbo.json
â””â”€ package.json
```

---

## âœ… Prerequisites

* Node.js 20+
* pnpm 9/10 (Corepack is fine)
* Docker Desktop (for local infra: Redis/Mongo/Rabbit)

---

## ğŸš€ Quick Start

### 1) Install

```bash
pnpm install
```

### 2) Environment files

* Shared (Docker/internal): `./.env.shared`
* Shared (local dev): `./.env.shared.local`
  Example:

  ``` bash
  MESSAGE_BROKER_URL=amqp://admin:admin@localhost:5672
  REDIS_URL=redis://localhost:6379
  DB_URL=mongodb://localhost:27017/bridgepoint
  NODE_ENV=development
  ```
  
* Service overrides (optional): `services/<svc>/.env`

> `@bridgepoint/env` loads **.env.shared.local â†’ .env.shared â†’ services/`<svc>`/.env** (later files override earlier).

### 3) Start infra (Redis/Mongo/Rabbit) in Docker

```bash
docker compose --profile infra up -d
```

### 4) Run all services locally (hot-reload)

```bash
pnpm dev
```

---

## ğŸ³ Run everything in Docker (optional)

Build app images (uses turbo prune + pnpm deploy):

```bash
docker compose --profile app build
```

Run infra + apps:

```bash
docker compose --profile infra --profile app up -d
```

Stop:

```bash
docker compose down
```

---

## ğŸ§© Shared Packages

### `@bridgepoint/env`

* Loads shared env from repo root and merges the service `.env`.
* Validates with **Zod**; each service can extend the base schema.

### `@bridgepoint/tsconfig`

* Central TypeScript config (ESM/NodeNext, strict).
* Services extend via: `../../packages/tsconfig/tsconfig.base.json`.

### `@bridgepoint/types`

* Central type definitions (DTOs, domain models).
* Uses **type-only imports** for Mongoose; declares `mongoose` as a **peerDependency**.

Build shared types:

```bash
pnpm --filter @bridgepoint/types build
```

---

## ğŸ”§ Root Scripts

```bash
pnpm dev         # turbo run dev --parallel (all services)
pnpm build       # turbo run build
```

Per service:

```bash
pnpm --filter @bridgepoint/gateway-api dev
pnpm --filter @bridgepoint/gateway-api build
```

---

## ğŸ”Œ Tech

* Node.js (TypeScript, ESM / NodeNext)
* pnpm + Turborepo
* MongoDB + Mongoose
* RabbitMQ
* Redis
* Docker Compose (profiles: `infra`, `app`)

---

## ğŸ“ Notes

* Only **gateway-api** exposes an HTTP port; other services are internal.
* `.env.shared.local` is for **local dev**; never commit secrets.
* Dockerfiles use `pnpm deploy --legacy` for pnpm v10 compatibility (safe for prod).
* Healthchecks exist for Redis/Mongo/Rabbit; consider `/healthz` endpoints per service.

---

## ğŸ§­ Troubleshooting

* **TS canâ€™t find shared tsconfig** â†’ use relative `extends: ../../packages/tsconfig/tsconfig.base.json` and restart TS server.
* **Imports show â€œ.jsâ€ errors** â†’ ensure `module` & `moduleResolution` are `NodeNext` in each service.
* **Shared types not found** â†’ make sure `@bridgepoint/types` is a dependency of the service and run `pnpm --filter @bridgepoint/types build`.

---

## ğŸ“ˆ Roadmap (v2)

* Service-level READMEs (endpoints, env, examples)
* CI build & remote turbo cache
* Local LLaMA service (GPU/CPU)
* Observability (logs/metrics/tracing)
